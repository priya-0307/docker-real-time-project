<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>To-Do List</title>
    <style>
      body { font-family: Arial, sans-serif; max-width: 700px; margin: 2rem auto; }
      li.done { text-decoration: line-through; color: #888; }
      form { margin-bottom: 1rem; }
      button { margin-left: 0.5rem; }
    </style>
  </head>
  <body>
    <h1>To-Do List</h1>

    <form id="addForm">
      <input id="title" placeholder="New task" required />
      <button>Add</button>
    </form>

    <ul id="todos"></ul>

    <script>
      async function fetchTodos() {
        const res = await fetch('/api/todos');
        const list = await res.json();
        const ul = document.getElementById('todos');
        ul.innerHTML = '';
        list.forEach(t => {
          const li = document.createElement('li');
          li.dataset.id = t.id;
          li.className = t.done ? 'done' : '';
          li.innerHTML = `<span>${t.title}</span>
            <button onclick="toggle(${t.id})">${t.done ? 'Undo' : 'Done'}</button>
            <button onclick="remove(${t.id})">Delete</button>`;
          ul.appendChild(li);
        });
      }

      async function add(e){
        e.preventDefault();
        const title = document.getElementById('title').value.trim();
        if(!title) return;
        await fetch('/api/todos', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ title })
        });
        document.getElementById('title').value = '';
        fetchTodos();
      }

      async function toggle(id){
        await fetch(`/api/todos/${id}`, { method: 'PUT' });
        fetchTodos();
      }

      async function remove(id){
        await fetch(`/api/todos/${id}`, { method: 'DELETE' });
        fetchTodos();
      }

      document.getElementById('addForm').addEventListener('submit', add);

      // initial load
      fetchTodos();
    </script>
  </body>
</html>
